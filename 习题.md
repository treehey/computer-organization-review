# 《计算机组织结构》期末习题课真题精选与解题攻略

---

## 第一部分：第1-4章 真题精选
*（题目来源：上传课件 `1-4章习题课.pdf`）*

### 第1章 计算机系统概述

#### 【真题 1.1】CPU 执行时间与占比计算
**题目**：
假设机器 M 的时钟频率为 4GHz。程序 P 在 M 上的指令条数为 $8 \times 10^9$，其 CPI 为 1.25。
1. P 在 M 上的执行时间是多少？
2. 若在 M 上从 P 启动到结束的总时间是 4s，则 P 占用的 CPU 时间百分比是多少？

**【解题】**
1. **执行时间**：
   $$T_{CPU} = \frac{IC \times CPI}{f} = \frac{8 \times 10^9 \times 1.25}{4 \times 10^9} = \frac{10}{4} = \mathbf{2.5s}$$
2. **CPU 占比**：
   $$\text{Percentage} = \frac{2.5s}{4s} \times 100\% = \mathbf{62.5\%}$$

#### 【真题 1.2】指令序列性能比较
**题目**：
编译器生成了两种指令序列 S1 和 S2，在 500MHz 机器上运行。
* **S1**: A(5条, CPI=1), B(2条, CPI=2), C(2条, CPI=3), D(1条, CPI=4)
* **S2**: A(1条, CPI=1), B(1条, CPI=2), C(1条, CPI=3), D(5条, CPI=4)
求 S1 和 S2 的 CPI、总周期数及执行时间。

**【解题】**
* **S1**:
    * 总指令数 = $5+2+2+1 = 10$
    * 总周期 = $5\times1 + 2\times2 + 2\times3 + 1\times4 = 10+2+6+4 = \mathbf{19}$
    * CPI = $22 / 10 = \mathbf{2.2}$
    * 时间 = $22 / (500 \times 10^6) = \mathbf{38ns}$
* **S2**:
    * 总指令数 = $1+1+1+5 = 8$
    * 总周期 = $1\times1 + 1\times2 + 1\times3 + 5\times4 = 2+1+3+20 = \mathbf{26}$
    * CPI = $26 / 8 = \mathbf{3.25}$
    * 时间 = $26 / (500 \times 10^6) = \mathbf{52ns}$
* **结论**：虽然 S2 指令少 (8条)，但 S1 (10条) 更快。

#### 【真题 1.3】优化替换计算
**题目**：
程序 P 执行时间 12s (1.2GHz)。优化时将所有“乘 4”指令换成“左移 2 位”指令。已知乘法 CPI=5，左移 CPI=2。优化后 P' 执行时间是 P 的 $1/1.2$。求有多少条乘法指令被替换？

**【解题】**
1. $T_P = 12s$，则 $T_{P'} = 12 / 1.2 = 10s$。**节省时间 2s**。
2. 节省的总周期数 = $2s \times 1.2GHz = 2.4 \times 10^9$ 周期。
3. 每条指令替换节省周期 = $5 - 2 = 3$ 周期。
4. 替换条数 = $(2.4 \times 10^9) / 3 = \mathbf{8 \times 10^8}$ **(8亿条)**。

---

### 第2章 数据的机器级表示

#### 【真题 2.1】IEEE 754 特殊数值转换 (必考)
**题目**：
将 **+19**, **-1/8**, **258** 表示为 IEEE 754 单精度十六进制。

[cite_start]**【解题关键】** [cite: 197-222]
1. **+19**:
   * 二进制：$10011_B = 1.0011 \times 2^4$。
   * 阶码：$4+127=131 (83H)$。
   * 尾数：`0011...`
   * 结果：`0 10000011 0011000...` $\rightarrow$ **41980000H**
2. **-1/8**:
   * 二进制：$-0.125 = -1.0 \times 2^{-3}$。
   * 阶码：$-3+127=124 (7CH)$。
   * 尾数：`0000...`
   * 结果：`1 01111100 0000000...` $\rightarrow$ **BE000000H**
3. **258**:
   * 二进制：$100000010_B = 1.0000001 \times 2^8$。
   * 阶码：$8+127=135 (87H)$。
   * 尾数：`0000001...`
   * 结果：`0 10000111 0000001...` $\rightarrow$ **43810000H**

#### 【真题 2.2】大端/小端存储分析
**题目**：
`x = -0.125` (float), `y = 7.5` (float), `i = 100` (short)。
地址分别为 100, 108, 112。画出 **大端 (Big Endian)** 和 **小端 (Little Endian)** 的内存内容。

[cite_start]**【解题】** [cite: 232-241]
* **数据准备**：
  * $x$ (-0.125) = **BE000000H**
  * $i$ (100) = **0064H** (16位)
* **存储布局**：
  * **大端 (Big Endian)**：
    * 100: **BE**, 101: 00, 102: 00, 103: 00
    * 112: **00**, 113: **64**
  * **小端 (Little Endian)**：
    * 100: **00**, 101: 00, 102: 00, 103: **BE** (低字节在低地址)
    * 112: **64**, 113: **00**

---

### 第3章 运算方法和运算部件

### 【真题 3.1】移位操作与 C 语言
**题目**：
输入 `w = 0x00000080` (128)。求返回值。

[cite_start]**【解题】** [cite: 252-269]
* **func1**: `w` 是 unsigned，右移是**逻辑右移 (补0)**。
  * `0x80` 左移24位 $\rightarrow$ `0x80000000`。
  * 逻辑右移24位 $\rightarrow$ `0x00000080` (**+128**)。
* **func2**: `w` 转 int，右移是**算术右移 (补符号位)**。
  * `0x80` 左移24位 $\rightarrow$ `0x80000000` (符号位为1)。
  * 算术右移24位 $\rightarrow$ `0xFFFFFF80` (**-128**)。

#### 【真题 3.2】Booth 乘法与不恢复余数除法
**题目**：
$x=10, y=-6$ (6位机器数)。计算 $[x \times y]_{\text{补}}$ (Booth) 和 $[x/y]_{\text{原}}$。

[cite_start]**【解题关键】** [cite: 309-455]
* **Booth乘法**:
  * $y_{\text{补}} = 111010$，辅助位 $y_{-1}=0$。
  * 序列判断：
    * `10`: $- [x]_{\text{补}}$
    * `01`: $+ [x]_{\text{补}}$
    * `00`/`11`: 仅移位。
  * 最终结果：**1111000100** (-60)。
* **不恢复余数除法**:
  * 符号位 $0 \oplus 1 = 1$ (负)。
  * 结果：商 **-1**, 余数 **4**。
  * 验证：$(-6) \times (-1) + 4 = 10$。

---

### 第4章 指令系统

#### 【真题 4.1】自定义指令格式分析
**题目**：
指令格式：OP(4) | Ms(3) | Rs(3) | Md(3) | Rd(3)。
寻址模式：000(寄存器直接), 001(寄存器间接), 010(寄存器间接自增), 011(相对寻址)。
写出 `add (R4), (R5)+` 的机器码。已知 `add` OP=0010。

[cite_start]**【解题】** [cite: 562-581]
* **源操作数 (R4)**：寄存器间接 $\rightarrow$ Ms=**001**, Rs=**100**。
* **目的操作数 (R5)+**：寄存器间接自增 $\rightarrow$ Md=**010**, Rd=**101**。
* **机器码拼接**：
  `0010` `001` `100` `010` `101`
  $\rightarrow$ **2315H**

#### 【真题 4.2】MIPS 代码性能分析
**题目**：
统计两个数组 (各2500字) 相同元素个数。主频 2GHz。
`add/addi/sll` CPI=1, `lw/bne` CPI=2。
问**最坏情况下** (所有元素都相同) 的执行时间。

[cite_start]**【解题】** [cite: 639-712]
* **指令计数**：
  * 内层循环主体指令：`add`, `lw`, `bne` (比较), `addi` (计数), `addi` (指针), `bne` (循环)。
  * 总指令数约 $3.75 \times 10^7$。
* **时间计算**：
  * 总周期数 $\approx$ 指令数 $\times$ 平均CPI。
  * 答案计算：$(1.87 \times 10^7 \times 1 + 1.87 \times 10^7 \times 2) \times 0.5ns \approx \mathbf{0.028s}$。

#### 【真题 4.3】栈帧画图 (Sum_array)
**题目**：
`sum_array` 调用 `compare`。画出栈帧。

[cite_start]**【解题】** [cite: 745-832]
* **栈帧大小**：8字节。
* **保存内容**：
  * `4($sp)`: **$ra** (返回地址)
  * `0($sp)`: **$fp** (旧帧指针)
* **代码模板**：
  ```mips
  addi $sp, $sp, -8   # 开栈
  sw   $ra, 4($sp)
  sw   $fp, 0($sp)
  addi $fp, $sp, 4    # 设新帧指针
  ...
  lw   $ra, 4($sp)
  lw   $fp, 0($sp)
  addi $sp, $sp, 8    # 退栈
  jr   $ra
---

# 《计算机组织结构》期末习题课真题精选 (第5-8章)  
**（题目来源：上传课件 `5-8章习题课.pdf`）**

---

## 第5章 中央处理器

### 【真题 5.1】单周期控制信号故障分析  
**题目** (Page 5, Q5)：  
单周期数据通路中，若 `RegWrite` (RegWr) 信号恒为 **0**，哪些指令不能正确执行？  
**【解题】**
* **分析**：`RegWrite` 控制是否将结果写回寄存器堆。 
* **受影响指令**：所有需要写寄存器的指令。*  
  * **R型** (`add`, `sub`, `sll` 等)
  * **I型计算** (`addi`, `ori` 等)
  * **Load** (`lw`)
* **不受影响**：`sw`, `beq`, `j`。

**题目** (Page 6, Q6)：  
若 `MemWrite` (MemWr) 恒为 **1**，哪些指令不能正确执行？  
**【解题】**
* **分析**：`MemWrite` 控制是否写内存。  
* **受影响指令**：除了 `sw` 以外的所有指令都会错误地修改内存。  
* **结论**：除 Store 指令外，其他都不正确。

### 【真题 5.2】新增指令实现 (Swap)  
**题目** (Page 7, Q7)：  
在 MIPS 中增加 `swap rs, rt` 指令。  
1\. **伪指令实现**：写出指令序列（不使用额外寄存器）。  
2\. **硬件实现**：若硬件实现导致每条指令变慢 10%，`swap` 占多少比例才划算？

\[cite*\_start\]**【解题】** \[cite: 947-958\]*  
1\. **伪指令序列** (利用异或交换算法)：
   ```mips  
   xor $rs, $rs, $rt  
   xor $rt, $rs, $rt  
   xor $rs, $rs, $rt
```
(注：共 3 条指令)  
2\. 性能平衡点计算：

* 设 swap 占比为 $x$。  
* **硬件方式耗时**：$1.1 \times 1$ (所有指令都变慢 10%)。  
* **软件方式耗时**：$3x + (1-x) \times 1 = 2x + 1$ (swap 变 3 条，其他不变)。  
* **不等式**：$1.1 < 2x + 1 \Rightarrow 2x > 0.1 \Rightarrow x > 5\%$。

---

## 第6章 指令流水线 (★重难点)

### **【真题 6.1】流水线停顿 (Stall) 分析**

题目 (Page 17, Q6)：  
分析以下指令序列在 5 段流水线（无转发）和（有转发）时的停顿。

    MIPS
    1. addu $s3, $s1, $s0  
    2. addu $t2, $s3, $s3  # 用到 $s3  
    3. lw   $t1, 0($t2)    # 用到 $t2  
    4. add  $t3, $t1, $t2  # 用到 $t1 (Load-Use)

**【解题】** 1

1. **无转发**：  
   * 1-2 相关：停顿 2 周期。  
   * 2-3 相关：停顿 2 周期。  
   * 3-4 相关：停顿 2 周期。  
   * **结论**：共需插入 **6 条 nop**。  
2. **有转发**：  
   * 1-2：**EX转发**，无停顿。  
   * 2-3：**EX转发**，无停顿。  
   * 3-4 (lw 后跟 add)：**Load-Use 冒险**，无法仅靠转发解决，**必须停顿 1 周期**。

### **【真题 6.2】Load-Use 循环调整**

题目 (Page 20, Q9)：  
调整指令顺序以消除 Load-Use 冒险。

    MIPS ```
    lw  $2, 100($6)  
    add $2, $2, $3      # Load-Use\!  
    lw  $3, 200($7)  
    add $6, $4, $7      # 无关指令

**【解题】** 2

* **策略**：找一条不依赖前面 lw 结果的指令插入中间。  
* **调整后**：  
    MIPS Assembler
    ```
    lw  $2, 100($6)  
    add $6, $4, $7      # 插入这条无关指令，填补气泡  
    add $2, $2, $3      # 现在可以转发了，无停顿  
    lw  $3, 200($7)  
    ...

### **【真题 6.3】分支预测准确率计算**

题目 (Page 24-26, Q12)：  
核心模块中 5 条分支指令的实际执行串（T=跳转, N=不跳）。

* B1: T-T-T  
* B2: N-N-N-N  
  ...  
  求 1位动态预测 (初始 T) 的准确率。

**【解题模板】** 3

* **1位预测机**：上次是什么，这次就猜什么。  
* **B1 (T-T-T)**:  
  * 猜T(初始) $\\to$ 实T (对) $\\to$ 下次猜T。  
  * 猜T $\\to$ 实T (对)。  
  * 猜T $\\to$ 实T (对)。  
  * **3对0错**。  
* **B2 (N-N-N-N)**:  
  * 猜T(初始) $\\to$ 实N (错) $\\to$ 下次猜N。  
  * 猜N $\\to$ 实N (对)...  
  * **3对1错**。  
* **统计所有分支**，计算 (总正确次数 / 总次数)。

 ---

## **第7章 存储器层次结构 (★必考大题)**

### **【真题 7.1】Cache 映射与替换 (Direct Mapping)**

题目 (Page 32, Q12)：  
Cache 16 行，块大小 1 字，直接映射。访问序列：2, 3, 11, 16, 21...  
计算命中率。

**【解题】** 4

* **映射公式**：$Row = \\text{Addr} \\mod 16$。  
* **访问过程**：  
  * **2** $\\to$ Row 2: Miss (空) $\\to$ 填入 2。  
  * **3** $\\to$ Row 3: Miss $\\to$ 填入 3。  
  * ...  
  * **16** $\\to$ Row 0: Miss。  
  * **19** $\\to$ Row 3: Miss (冲突\! 替换掉 3\) $\\to$ 填入 19。  
  * **11** $\\to$ Row 11: Hit? (前面访问过 11 且没被踢) $\\to$ **Hit**。  
* **统计**：命中次数 / 总次数。

### **【真题 7.2】TLB-页表-Cache 综合寻址**

题目 (Page 42, Q25)：  
虚拟地址 16 位，物理地址 12 位，页大小 128B。  
TLB 4路组相联；Cache 直接映射，块大小 4B。  
给定 TLB 表和页表内容，求 CPU 读取地址 067AH 的过程。

**【解题模板】** 5

1. **地址分解**：  
   * $067AH = 0000\\ 0110\\ 0111\\ 1010\_B$。  
   * **Offset**: 页大小 128B ($2^7$) $\rightarrow$ 低 7 位 1111010 ($7AH$)。  
   * **VPN**: 高 9 位 000001100 ($0CH$)。  
2. **查 TLB/页表**：  
   * 查页表索引 0C，找到 PPN (物理页号) = 19H ($11001\_B$)。  
3. **物理地址合成**：  
   * PA = PPN :: Offset = 11001 1111010 = 1100 1111 1010 ($CFAB$)。  
4. **查 Cache**：  
   * PA = 110011111010。  
   * **Byte Offset**: 2位 (4B块) $\rightarrow$ 10 (2)。  
   * **Cache Index**: 16行 ($2^4$) $\rightarrow$ 中间4位 1110 ($E$, 第14行)。  
   * **Tag**: 剩余高位 110011 ($33H$)。  
   * **比对**：检查 Cache 第 14 行的 Tag 是否为 33H。若 Valid=1 且 Tag 匹配，则命中，取第 2 字节。

 ---

## **第8章 系统互联及 I/O**

### **【真题 8.1】中断 vs DMA 可行性分析**

题目 (Page 46, Q7)：  
外设传输率 20KB/s。中断服务耗时 500 周期，主频 500MHz。

1. 可否用中断？  
2. 若传输率改为 2MB/s，可否用中断？

**【解题】** 6

1. **20KB/s 情况**：  
   * 中断间隔 = $1/20K = 50 \\mu s$。  
   * 处理时间 = $500 / 500M = 1 \\mu s$。  
   * $1 \\mu s \\ll 50 \\mu s$，**可以**。  
2. **2MB/s 情况**：  
   * 中断间隔 = $1/2M = 0.5 \\mu s$。  
   * 处理时间 = $1 \\mu s$。  
   * $1 \\mu s > 0.5 \\mu s$ (处理不过来)，**不可以，必须用 DMA**。

### **【真题 8.2】中断屏蔽与嵌套**

题目 (Page 47, Q8)：  
响应优先级：1>2>3>4>5。处理优先级：1>4>5>2>3。  
设置中断屏蔽字（1屏蔽，0开放）。

**【解题模板】** 7

* **原则**：屏蔽自己、屏蔽比自己处理优先级低的。  
* **以 2号中断为例**：  
  * 比 2 高的有：1, 4, 5。 $\rightarrow$ 开放 (设0)。  
  * 比 2 低的有：3。 $\rightarrow$ 屏蔽 (设1)。  
  * 屏蔽自己 (2)。 $\rightarrow$ 屏蔽 (设1)。  
  * **2号屏蔽字**：1(1号开), 1(2号关), 1(3号关), 0(4号开), 0(5号开) $\rightarrow$ **11100** (假设位序 12345)。  
  * *(注：课件中 1# 屏蔽字为 "11111" (全1)，说明课件约定 **1为屏蔽**)*。

### **【真题 8.3】磁盘 DMA 与 CPU 冲突**

题目 (Page 49, Q9)：  
磁盘 1MB/s，总线宽度 16位 (2B)。主存周期 500ns。  
DMA 挪用周期传送。求 CPU 此时的主存空闲比例。

**【解题】** 8

1. **DMA 请求频率**：$1MB/s \\div 2B = 500k$ 次/s。  
2. **DMA 请求间隔**：$1 / 500k = 2 \\mu s = 2000 ns$。  
3. **主存周期数**：$2000ns / 500ns = 4$ 个周期。  
4. **占用分析**：每 4 个周期中，DMA 挪用 1 个。  
5. **空闲比例**：$(4-1)/4 = \\mathbf{75\%}$。